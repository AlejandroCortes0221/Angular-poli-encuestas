<div
  class="w-full h-full flex flex-col justify-start items-center p-8 bg-theme-blue-king rounded-2xl shadow-xl text-white overflow-auto"
>
  <header class="w-full pb-6 border-b border-white/10 mb-8">
    <h1 class="text-4xl font-semibold text-white">{{ data ? 'Editar' : 'Crear Nueva' }} Encuesta</h1>
    <p class="text-gray-400 text-base mt-1">
      Define la estructura y añade las preguntas a tu encuesta.
    </p>
  </header>

  <form class="w-full h-full max-w-6xl flex flex-col gap-1">

    <div class="flex gap-6 w-full h-full">

      <!-- ========== COLUMNA IZQUIERDA ========== -->
      <div class="flex flex-col gap-6 w-1/3 min-w-[300px]">

        <!-- Detalles principales -->
        <div class="bg-[#1432727e] p-6 rounded-xl shadow-lg shadow-black/20">
          <h2 class="text-xl font-bold mb-4 flex items-center gap-3">
            <i class="fa-solid fa-clipboard-list text-theme-blue-king "></i>
            1. Detalles Principales
          </h2>

          <div class="mb-4">
            <label for="titulo" class="block text-sm font-medium mb-1 text-gray-300">Título</label>
            <input
              type="text"
              id="titulo"
              [(ngModel)]="titulo"
              name="titulo"
              placeholder="Título de la Encuesta"
              class="w-full py-2 px-3 rounded-lg bg-[#2c51a07e] border border-white/10 text-white placeholder-gray-500"
            />
          </div>

          <div>
            <label for="descripcion" class="block text-sm font-medium mb-1 text-gray-300">Descripción</label>
            <textarea
              id="descripcion"
              name="descripcion"
              rows="4"
              [(ngModel)]="descripcion"
              placeholder="Objetivo y duración..."
              class="w-full py-2 px-3 rounded-lg bg-[#2c51a07e] border border-white/10 text-white placeholder-gray-500"
            ></textarea>
          </div>
        </div>

        <!-- Configuración -->
        <div class="bg-[#1432727e] p-6 rounded-xl shadow-lg shadow-black/20">
          <h2 class="text-xl font-bold mb-4 flex items-center gap-3">
            <i class="fa-solid fa-gear text-[#FADF63]"></i>
            Configuración
          </h2>

          <div class="mb-4">
            <label for="fecha_cierre" class="block text-sm font-medium mb-1 text-gray-300">Fecha de Cierre</label>
            <input
              type="date"
              id="fecha_cierre"
              name="fecha_cierre"
              [(ngModel)]="fechaCierre"
              class="w-full py-2 px-3 rounded-lg bg-[#2c51a07e] border border-white/10 text-white"
            />
          </div>

          <div>
            <label for="empresa" class="block text-sm font-medium mb-1 text-gray-300">Empresa</label>
            <select
              id="empresa"
              name="empresa"
              [(ngModel)]="Empresa"
              class="w-full py-2 px-3 rounded-lg bg-[#2c51a07e] border border-white/10 text-white"
            >
             @for (empresa of empresasUsuario(); track empresa.id) {
              <option [ngValue]="empresa.id">{{empresa.nombre}}</option>
             }
              
            </select>
          </div>
        </div>
      </div>

      <!-- ========== COLUMNA DERECHA (PREGUNTAS) ========== -->
      <div class="w-2/3">
        <div class="bg-[#1432727e] p-6 rounded-xl shadow-lg shadow-black/20 h-full overflow-auto">

          <h2 class="text-xl font-bold mb-6 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-circle-question text-[#78C2AD]"></i>
              2. Preguntas de la Encuesta
            </div>

            <button
              type="button"
              (click)="agregarPregunta()"
              class="bg-[#78C2AD] text-white font-medium py-2 px-4 rounded-lg hover:bg-[#68a892] transition-colors flex items-center gap-2 cursor-pointer"
            >
              <i class="fa-solid fa-plus"></i> Añadir Pregunta
            </button>
          </h2>

          <!-- LISTA DE PREGUNTAS DINÁMICAS -->
          @for (pregunta of preguntas; let i = $index; track i) {
            <div class="border border-white/10 p-4 rounded-lg mb-4 bg-[#2c51a07e]">

              <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-semibold text-gray-300">
                  Pregunta {{ i + 1 }}
                </span>

                <select
                  [(ngModel)]="pregunta.tipo"
                  name="tipo_{{ i }}"
                  class="py-1 px-2 rounded-md text-xs bg-[#2D2A57] border border-white/10"
                  (change)="cambiarTipo(pregunta)"
                >
                  <option value="multiple">Opción Múltiple</option>
                  <option value="texto">Texto Corto</option>
                </select>
              </div>

              <!-- Texto de la pregunta -->
              <input
                type="text"
                name="pregunta_{{ i }}"
                [(ngModel)]="pregunta.texto"
                placeholder="Escribe aquí el texto de la pregunta..."
                class="w-full py-2 px-3 rounded-lg bg-[#3b3b3be0]  border border-white/10 text-white mb-3"
              />

              <!-- Opciones si es tipo multiple -->
              @if (pregunta.tipo === 'multiple') {
                <div class="text-sm text-gray-300">
                  <p class="mb-1">Opciones:</p>

                  @for (opcion of pregunta.opciones; let idx = $index; track idx) {
                    <div class="flex items-center mb-1 gap-2">
                      <i class="fa-regular fa-square text-[#28d44d]"></i>

                      <input
                        type="text"
                        [(ngModel)]="pregunta.opciones[idx]"
                        name="opcion_{{ i }}_{{ idx }}"
                        class="w-full py-1 px-2 rounded-md bg-[#3b3b3be0]   border border-white/10 text-white text-sm"
                      />

                      <button
                        type="button"
                        class="text-red-600 text-xs cursor-pointer hover:text-red-400"
                        (click)="eliminarOpcion(pregunta, idx)"
                      >
                        <i class="fa-solid fa-xmark"></i>
                      </button>
                    </div>
                  }

                  <button
                    type="button"
                    (click)="agregarOpcion(pregunta)"
                    class="mt-2 text-white text-sm hover:underline cursor-pointer"
                  >
                    <i class="fa-solid fa-plus"></i> Añadir Opción
                  </button>
                </div>
              } @else {
                <span class="text-sm text-gray-400">Respuesta de texto.</span>
              }
            </div>
          }

        </div>
      </div>
    </div>

    <!-- BOTÓN GUARDAR -->
    <div class="w-full flex justify-end mt-4">
      <button
        type="button"
        (click)="guardar()"
        class="bg-[#2c51a07e] text-white font-bold text-lg py-3 px-8 rounded-xl hover:bg-[#224797e0] transition-colors shadow-lg shadow-theme-blue-king/40 flex items-center gap-2 cursor-pointer mb-4"
      >
        <i class="fa-solid fa-paper-plane"></i>
        Guardar y Publicar Encuesta
      </button>
    </div>

  </form>
</div>
<loading [type]="popupType" [message]="popupMessage()"></loading>
